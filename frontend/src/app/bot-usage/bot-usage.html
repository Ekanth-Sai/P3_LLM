<div class="bot-usage-container">
    <header class="top-bar">
        <span class="logo">LLM Chatbot</span>
        <a href="/" class="home-link">Home</a>
    </header>

    <main class="main-content">
        <h1 class="welcome-text">Welcome, <span id="username"></span>! </h1>
         

        <script>
            fetch('http://localhost:8080/api/user/me', { credentials: 'include' })
              .then(response => response.json())
              .then(data => {
                console.log("Response data:", data);  // ðŸ‘ˆ Add this for debugging
                document.getElementById('username').innerText = data.username;
              })
              .catch(err => console.error("Fetch error:", err));
          </script>

        <p class="subtext">
            Ask questions, upload documents, and explore your conversation history
        </p>

        <div class="chat-card">
            <div class="tab-bar">
                <button class="tab" [class.active]="activeTab === 'chat'" (click)="showChat()">ðŸ’¬ Chat</button>
                <button class="tab" [class.active]="activeTab === 'documents'" *ngIf="isAdmin" (click)="showDocuments()">ðŸ“„ Documents</button>
                <button class="tab" [class.active]="activeTab === 'history'" (click)="showHistory()">ðŸ•’ History</button>
            </div>

            <div class="chat-body" *ngIf="activeTab === 'chat'">
                <!-- Message Display Area -->
                <div class="message-area">
                    <div *ngFor="let message of messages" class="message" [ngClass]="{'user-message': message.isUser, 'bot-message': !message.isUser}">
                        <div class="message-bubble">{{ message.text }}</div>
                    </div>
                </div>

                <div class="bot-welcome" *ngIf="messages.length === 0">
                    <div class="bot-icon">ðŸ¤–</div>
                    <p class="bot-title">Welcome to LLM ChatBot</p>
                    <p class="bot-description">
                        Ask me anything about your documentation, and Iâ€™ll help you find the answers.
                    </p>
                </div>

                <div class="chat-input">
                    <input type="text" 
                        placeholder="Ask me about to explain the project" 
                        [(ngModel)]="newMessage" 
                        (keydown.enter)="sendMessage()">
                    <button class="send-btn" (click)="sendMessage()">ðŸ“¨</button>
                </div>
            </div>

            <div class="history-body" *ngIf="activeTab === 'history'">
                <div *ngIf="history.length === 0" class="no-history">
                    <p>No conversation history found.</p>
                </div>
                <div *ngIf="history.length > 0" class="history-list">
                    <div *ngFor="let conv of history" class="history-item">
                        <p><strong>You:</strong> {{ conv.query }}</p>
                        <p><strong>Bot:</strong> {{ conv.response }}</p>
                        <p class="timestamp">{{ conv.timestamp | date:'medium' }}</p>
                    </div>
                </div>
            </div>

            <div class="documents-body" *ngIf="activeTab === 'documents'">
                <div *ngIf="documents.length === 0" class="no-documents">
                    <p>No documents found.</p>
                </div>
                <div *ngIf="documents.length > 0" class="documents-list">
                    <ul>
                        <li *ngFor="let doc of documents">{{ doc.filename }}</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
</div>