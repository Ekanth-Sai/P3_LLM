<div class="bot-usage-container">
    <header class="top-bar">
        <span class="logo">LLM Chatbot</span>
        <a href="/" class="home-link">Home</a>
    </header>

    <main class="main-content">
        <h1 class="welcome-text">Welcome {{ username }}</h1>
        <p class="subtext">
            Ask questions, upload documents, and explore your conversation history
        </p>

        <div class="chat-card">
            <div class="tab-bar">
                <button class="tab" [class.active]="activeTab === 'chat'" (click)="showChat()">ğŸ’¬ Chat</button>
                <button class="tab" [class.active]="activeTab === 'documents'" *ngIf="isAdmin"
                    (click)="showDocuments()">ğŸ“„ Documents</button>
                <button class="tab" [class.active]="activeTab === 'history'" (click)="showHistory()">ğŸ•’ History</button>
            </div>

            <div class="chat-body" *ngIf="activeTab === 'chat'">
                <div class="message-area">
                    <div *ngFor="let message of messages" class="message"
                        [ngClass]="{'user-message': message.isUser, 'bot-message': !message.isUser}">
                        <div class="message-bubble">{{ message.text }}</div>
                    </div>
                </div>

                <div class="bot-welcome" *ngIf="messages.length === 0">
                    <div class="bot-icon">ğŸ¤–</div>
                    <p class="bot-title">Welcome to LLM ChatBot</p>
                    <p class="bot-description">
                        Ask me anything about your documentation, and I'll help you find the answers.
                    </p>
                </div>

                <div class="chat-input">
                    <input type="text" placeholder="Ask me to explain the project" [(ngModel)]="newMessage"
                        (keydown.enter)="sendMessage()">
                    <button class="send-btn" (click)="sendMessage()">ğŸ“¨</button>
                </div>
            </div>

            <div class="history-body" *ngIf="activeTab === 'history'">
                <div *ngIf="history.length === 0" class="no-history">
                    <p>No conversation history found.</p>
                </div>
                <div *ngIf="history.length > 0" class="history-list">
                    <div *ngFor="let conv of history" class="history-item">
                        <p><strong>You:</strong> {{ conv.query }}</p>
                        <p><strong>Bot:</strong> {{ conv.response }}</p>
                        <p class="timestamp">{{ conv.timestamp | date:'medium' }}</p>
                    </div>
                </div>
            </div>

            <div class="documents-body" *ngIf="activeTab === 'documents' && isAdmin">
                <div class="documents-header">
                    <h3>Knowledge Base Documents</h3>
                    <p class="subtitle">Manage files used by the LLM</p>
                </div>

                <div *ngIf="loadingDocuments" class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Loading documents...</p>
                </div>

                <div *ngIf="!loadingDocuments && documents.length === 0" class="no-documents">
                    <p>ğŸ“­ No documents in knowledge base</p>
                </div>

                <div *ngIf="!loadingDocuments && documents.length > 0" class="documents-list">
                    <div *ngFor="let doc of documents" class="document-item">
                        <div class="doc-info">
                            <span class="doc-icon">ğŸ“„</span>
                            <span class="doc-name">{{ doc.filename }}</span>
                        </div>
                        <button class="delete-doc-btn" (click)="deleteDocument(doc.filename)">
                            ğŸ—‘ï¸ Delete
                        </button>
                    </div>
                </div>

                <!-- Delete confirmation message -->
                <div *ngIf="deleteMessage" class="delete-message"
                    [ngClass]="{'success': deleteSuccess, 'error': !deleteSuccess}">
                    {{ deleteMessage }}
                </div>
            </div>
        </div>
    </main>
</div>