imports: [FormsModule, CommonModule, HttpClientModule],
<div class="bot-usage-container">

  <nav class="navbar">
    <div class="nav-left">
      <img src="assets/images/logo.png" (click)="goBackToDashboard()" alt="P3 Logo" class="logo"
        style="cursor:pointer;" />
      <span class="title">Chat Bot</span>
    </div>

    <div class="nav-right-container">
      <div class="nav-right" (click)="goBackToDashboard()" style="cursor:pointer">Home</div>
      <button class="logout-btn" (click)="onLogout()">Sign Out</button>
    </div>
  </nav>

  <main class="main-content">
    <h1 class="welcome-text">Welcome {{ username }}</h1>
    <p class="subtext">
      Ask questions, upload documents, and explore your conversation history
    </p>

    <div class="chat-card">
      <div class="tab-bar">
        <button class="tab" [class.active]="activeTab === 'chat'" (click)="showChat()">üí¨ Chat</button>
        <button class="tab" [class.active]="activeTab === 'documents'" *ngIf="isAdmin" (click)="showDocuments()">üìÑ
          Documents</button>
        <button class="tab" [class.active]="activeTab === 'history'" (click)="showHistory()">üïí History</button>
      </div>

      <div class="chat-body" *ngIf="activeTab === 'chat'">
        <div class="message-area">
          <div *ngFor="let message of messages" class="message-row"
            [ngClass]="{'user-message': message.isUser, 'bot-message': !message.isUser}">

            <!-- Avatar -->
            <img *ngIf="!message.isUser" src="assets/images/bot-avatar.png" alt="Bot" class="avatar bot-avatar" />

            <div class="message-bubble">{{ message.text }}</div>

            <img *ngIf="message.isUser" src="assets/images/user-avatar.png" alt="You" class="avatar user-avatar" />

          </div>


          <div *ngIf="isGeneratingResponse" class="message bot-message">
            <!-- Avatar -->
            <img src="assets/images/bot-avatar.png" alt="Bot" class="avatar bot-avatar" />
            <div class="message-bubble typing-bubble">
              <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>
          </div>
        </div>


        <div class="bot-welcome" *ngIf="messages.length === 0">
          <!-- Avatar -->
          <img src="assets/images/bot-avatar.png" alt="Bot" class="bot-hello" />
          <p class="bot-title">Welcome to LLM ChatBot</p>
          <p class="bot-description">
            Ask me anything about your documentation, and I'll help you find the answers.
          </p>
        </div>

        <div class="chat-input">
          <input type="text"
            [placeholder]="isGeneratingResponse ? 'ü§ñ Generating response...' : 'Ask me to explain the project'"
            [(ngModel)]="newMessage" (keydown.enter)="sendMessage()" [disabled]="isGeneratingResponse">

          <button class="send-btn" (click)="sendMessage()" [disabled]="isGeneratingResponse">
            {{ isGeneratingResponse ? '‚è≥' : 'üì®' }}
          </button>
        </div>
      </div>

      <div class="history-body" *ngIf="activeTab === 'history'">
        <div *ngIf="history.length === 0" class="no-history">
          <p>No conversation history found.</p>
        </div>
        <div *ngIf="history.length > 0" class="history-list">
          <div *ngFor="let conv of history" class="history-item">
            <p><strong>You:</strong> {{ conv.query }}</p>
            <p><strong>Bot:</strong> {{ conv.response }}</p>
            <p class="timestamp">{{ conv.timestamp | date:'medium' }}</p>
          </div>
        </div>
      </div>

      <div class="documents-body" *ngIf="activeTab === 'documents' && isAdmin">

        <div class="documents-header">
          <h3>Knowledge Base</h3>
          <p class="subtitle"></p>
        </div>

        <div *ngIf="loadingDocuments" class="loading-spinner">
          <div class="spinner"></div>
          <p>Loading documents...</p>
        </div>

        <div *ngIf="!loadingDocuments && departmentNames.length === 0" class="no-documents">
          <p>üì≠ No documents uploaded yet</p>
        </div>

        <div *ngIf="!loadingDocuments && departmentNames.length > 0" class="documents-list">

          <div *ngFor="let dept of departmentNames" class="department-section">
            <div class="project-header" (click)="toggleDepartment(dept)">
              <span class="project-name">üè¢ {{ dept }}</span>
              <span class="arrow">{{ expandedDepartments[dept] ? '‚ñº' : '‚ñ∂' }}</span>
            </div>

            <div *ngIf="expandedDepartments[dept]">
              <div *ngFor="let project of Object.keys(groupedFiles[dept])" class="project-section">

                <div class="project-header level-2" (click)="toggleProject(dept, project)">
                  <span class="project-name">üóÇÔ∏è {{ project }}</span>
                  <span class="arrow">{{ expandedProjects[dept][project] ? '‚ñº' : '‚ñ∂' }}</span>
                </div>

                <div class="project-files" *ngIf="expandedProjects[dept][project]">
                  <div *ngFor="let file of groupedFiles[dept][project]" class="document-item">
                    <div class="doc-info">
                      <span class="doc-icon">üìÑ</span>
                      <span class="doc-name">{{ file.filename }}</span>
                    </div>
                    <div class="doc-actions">
                      <button class="download-doc-btn" (click)="downloadFile(file)"> Download</button>
                      <button class="delete-doc-btn" (click)="deleteDocument(file.filename)"> Delete</button>
                    </div>
                  </div>
                </div>

              </div>
            </div>

          </div>

        </div>
      </div>
    </div>
  </main>
</div>